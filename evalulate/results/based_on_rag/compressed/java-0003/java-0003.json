{
  "reason": "ActivityManager.getRunningAppProcesses() can return null, but LeakCanaryInternals.isInServiceProcess() does not handle this case, leading to a NullPointerException when trying to iterate over the null list.",
  "location": [
    "leakcanary-android/src/main/java/com/squareup/leakcanary/internal/LeakCanaryInternals.java"
  ],
  "fix": "Modify the isInServiceProcess method to check if the list returned by getRunningAppProcesses is null before attempting to iterate over it. For example:\n\npublic static boolean isInServiceProcess(Context context, Class<? extends Service> serviceClass) {\n  PackageManager packageManager = context.getPackageManager();\n  PackageInfo packageInfo;\n  try {\n    packageInfo = packageManager.getPackageInfo(context.getPackageName(), GET_SERVICES);\n  } catch (Exception e) {\n    CanaryLog.d(e, \"Could not get package info for %s\", context.getPackageName());\n    return false;\n  }\n  String mainProcess = packageInfo.applicationInfo.processName;\n  String serviceName = serviceClass.getName();\n  ComponentName component = new ComponentName(context, serviceClass);\n  ServiceInfo serviceInfo;\n  try {\n    serviceInfo = packageManager.getServiceInfo(component, PackageManager.GET_META_DATA);\n  } catch (PackageManager.NameNotFoundException ignored) {\n    // Service is disabled.\n    return false;\n  }\n  if (serviceInfo.processName.equals(mainProcess)) {\n    // Technically we are in the service process, but we're not in the service dedicated process.\n    return false;\n  }\n  int myPid = android.os.Process.myPid();\n  ActivityManager activityManager =\n      (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);\n  List<ActivityManager.RunningAppProcessInfo> runningProcesses = activityManager.getRunningAppProcesses();\n  if (runningProcesses == null) {\n    return false;\n  }\n  for (ActivityManager.RunningAppProcessInfo processInfo : runningProcesses) {\n    if (processInfo.pid == myPid && processInfo.processName.equals(serviceInfo.processName)) {\n      return true;\n    }\n  }\n  return false;\n}"
}